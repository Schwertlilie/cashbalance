var V=Object.defineProperty;var K=(o,e,t)=>e in o?V(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>(K(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();class g{constructor(e,t){i(this,"currentPage","");var n;this.defaultPage=e,this.pages=t;for(const a in t)(n=document.getElementById("app"))==null||n.appendChild(t[a].htmlElement),t[a].hide();window.onhashchange=a=>{this.onOpen()},location.hash.slice(1)==""?location.hash="#"+e:this.onOpen()}onOpen(){var r,u,p;let e={},t=this.defaultPage,a=location.hash.slice(1).split("&");a.length>0&&(t=a[0],a=a.splice(1));for(const C of a){let O=C.split("="),_=decodeURIComponent(O[0]),w=decodeURIComponent(O[1]);e[_]=w}let s=this.currentPage!=t;s&&(console.log("Hide page: "+this.currentPage),(r=this.pages[this.currentPage])==null||r.hide(),this.currentPage=t,console.log("Show page: "+t),(u=this.pages[this.currentPage])==null||u.show()),console.log("Calling page.update with: "+JSON.stringify(e)),(p=this.pages[this.currentPage])==null||p.update(e,s)}static open(e,t){window.setTimeout(()=>{let n="";for(let a in t)n+="&"+encodeURIComponent(a)+"="+encodeURIComponent(t[a]);location.hash="#"+encodeURIComponent(e)+n},200)}static back(){history.back()}}class c{constructor(){}static APPLY_COUNTED(e,t){return t.replace("{count}",e.toString())}}i(c,"ERROR_INVALID_SESSION","No valid session opened, go back to login."),i(c,"ERROR_SAVE_FILE","Cannot save file. It was either changed on the server or you have too weak internet."),i(c,"ERROR_READ_MD5","Cannot read md5 of file. Maye there was an error saving or your internet is weak."),i(c,"ERROR_READ_FILE","Cannot read file. Probably due to weak internet connection."),i(c,"ERROR_CREATE_FILE","Cannot create file. Probably due to weak internet connection or lack of permissions."),i(c,"ERROR_UNKNOWN_DATASTRUCTURE","Cannot parse csv due to unknown header."),i(c,"ERROR_EDIT_EMPTY_INPUT","Cannot save transaction due to empty input "),i(c,"TIME_LOCALE","en"),i(c,"TIME_YESTERDAY","yesterday"),i(c,"TIME_HOURS_AGO","{count} hour(s) ago"),i(c,"TIME_MINUTES_AGO","{count} minute(s) ago"),i(c,"TIME_SECONDS_AGO","{count} second(s) ago"),i(c,"TIME_TODAY_AT","today at"),i(c,"TIME_JUST_NOW","just now"),i(c,"APPNAME","Cashbalance"),i(c,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),i(c,"LOGIN_SESSION_NAME","Session Name"),i(c,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),i(c,"LOGIN_API_TOKEN_LABEL","API Token"),i(c,"LOGIN_SUBMIT","Add Connection"),i(c,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),i(c,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),i(c,"EDIT_CAPTION_DATE","Date"),i(c,"EDIT_CAPTION_CATEGORY","Category"),i(c,"EDIT_CAPTION_SHOP","Shop"),i(c,"EDIT_CAPTION_AMOUNT","Amount"),i(c,"EDIT_CAPTION_RECEIPT","Receipt"),i(c,"EDIT_CAPTION_COST_CENTER","Cost center"),i(c,"EDIT_CAPTION_NOTE","Note"),i(c,"EDIT_RADIO_IN","In"),i(c,"EDIT_RADIO_OUT","Out"),i(c,"EDIT_CHECKBOX_CASH","Cash"),i(c,"EDIT_CHECKBOX_TAX","Tax"),i(c,"EDIT_CHECKBOX_DRAFT","Draft"),i(c,"EDIT_BUTTON_SAVE","Save"),i(c,"EDIT_PLACEHOLDER_DATE","2023-09-01"),i(c,"EDIT_PLACEHOLDER_CATEGORY","Alimentary"),i(c,"EDIT_PLACEHOLDER_SHOP","Rewe"),i(c,"EDIT_PLACEHOLDER_AMOUNT","0.00"),i(c,"EDIT_PLACEHOLDER_RECEIPT","/path/to/receipt.png"),i(c,"EDIT_PLACEHOLDER_NOTE",""),i(c,"EDIT_PLACEHOLDER_COST_CENTER","XF"),i(c,"EDIT_LIST_COST_CENTER",["XF","MF","IF","Other"]);class m extends c{}i(m,"TIME_LOCALE","de"),i(m,"EDIT_CAPTION_DATE","Datum"),i(m,"EDIT_CAPTION_CATEGORY","Kategorie"),i(m,"EDIT_CAPTION_SHOP","Handelspartner"),i(m,"EDIT_CAPTION_AMOUNT","Betrag"),i(m,"EDIT_CAPTION_RECEIPT","Beleg"),i(m,"EDIT_CAPTION_COST_CENTER","Kostenstelle"),i(m,"EDIT_CAPTION_NOTE","Notiz"),i(m,"EDIT_RADIO_IN","Ein"),i(m,"EDIT_RADIO_OUT","Aus"),i(m,"EDIT_CHECKBOX_CASH","Bar"),i(m,"EDIT_CHECKBOX_TAX","Steuerrelevant"),i(m,"EDIT_CHECKBOX_DRAFT","Entwurf"),i(m,"EDIT_BUTTON_SAVE","Speichern"),i(m,"EDIT_PLACEHOLDER_CATEGORY","Lebensmittel & Haushalt"),i(m,"EDIT_PLACEHOLDER_SHOP","Rewe"),i(m,"EDIT_PLACEHOLDER_RECEIPT","/path/to/receipt.png"),i(m,"EDIT_LIST_COST_CENTER",["XF","MF","IF","Andere"]);let l=c;function Y(){switch(localStorage.language){case"en":case"us":l=c;break;case"de":default:l=m;break}}class E{constructor(e){i(this,"apiEndpoint","");i(this,"sessionToken","");this.session_name=e,this.loadSessionConfig()}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);if(this.session_name in e){let t=e[this.session_name];this.apiEndpoint=t.apiEndpoint,this.sessionToken=t.sessionToken}}}writeSessionConfig(e,t){this.apiEndpoint=e,this.sessionToken=t;let n={};localStorage.webfs_sessions&&(n=JSON.parse(localStorage.webfs_sessions)),n[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:t},localStorage.webfs_sessions=JSON.stringify(n)}removeSession(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);e.indexOf(this.session_name)>=0&&e.remove(this.session_name)}}async request(e){e.append("token",this.sessionToken);const t={method:"POST",body:e};try{return await fetch(this.apiEndpoint,t)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let e=new FormData;e.append("cmd","ping"),e.append("uri",".");let t=await this.request(e);return t==null?!1:t.status!=200?(console.error(t.text()),!1):await t.text()=="pong"}async login(e,t){let n=new FormData;n.append("cmd","login"),n.append("uri","."),n.append("token",t);const a={method:"POST",body:n};let s;try{s=await fetch(e,a)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(s.status!=200)return console.error(s.text()),!1;let r=await s.text();return this.writeSessionConfig(e,r),!0}buildFileTree(e){return e}async list(e){let t=new FormData;t.append("cmd","list"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):await n.json()}async walk(e){let t=new FormData;t.append("cmd","walk"),t.append("uri",e);let n=await this.request(t);if(n==null)return null;if(n.status!=200)return console.error(n.text()),null;let a=await n.json();return this.buildFileTree(a)}async md5(e){let t=new FormData;t.append("cmd","md5"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}async open(e){let t=new FormData;t.append("cmd","open"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async readTxt(e){let t=new FormData;t.append("cmd","read"),t.append("uri",e);let n=await this.request(t);return n==null?null:n.status!=200?(console.error(n.text()),null):n.text()}readURL(e,t=0){let n="";return t!=0&&(n="&subsample=1&width="+t.toFixed(0)+"&height="+t.toFixed(0)),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(e)+n}read(e,t="_self"){function n(r,u,p){let C=document.createElement("input");C.type="hidden",C.name=u,C.value=p,r.appendChild(C)}let a=document.getElementsByTagName("body")[0],s=document.createElement("form");s.action=this.apiEndpoint,s.method="post",s.target=t,n(s,"cmd","read"),n(s,"token",this.sessionToken),n(s,"uri",e),a.appendChild(s),s.submit(),a.removeChild(s)}async putTxt(e,t,n){let a="",s=new FormData;s.append("cmd","write"),s.append("operation","writeTxt"),s.append("uri",e),s.append("file",t),s.append("md5",n+","+a);let r=await this.request(s);return r==null?!1:r.status!=200?(console.error(r.text()),!1):(await r.text(),!0)}async putFile(e,t,n){let a="",s=new FormData;s.append("cmd","write"),s.append("operation","write"),s.append("uri",e),s.append("file",t),s.append("md5",n+","+a);let r=await this.request(s);return r==null?!1:r.status!=200?(console.error(r.text()),!1):(await r.text(),!0)}async mkdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","mkdir"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rmdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","rmdir"),t.append("uri",e);let n=await this.request(t);return n==null?!1:n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async mv(e,t){let n=new FormData;n.append("cmd","write"),n.append("operation","mv"),n.append("uri",e),n.append("target",t);let a=await this.request(n);return a==null?!1:a.status!=200?(console.error(a.text()),!1):(await a.text(),!0)}async rm(e,t){let n=new FormData;n.append("cmd","write"),n.append("operation","rm"),n.append("uri",e),n.append("md5",t);let a=await this.request(n);return a==null?!1:a.status!=200?(console.error(a.text()),!1):(await a.text(),!0)}}i(E,"instance",null);class d{constructor(e,t="",n=""){i(this,"parent",null);i(this,"htmlElement");i(this,"displayStyle","none");this.htmlElement=document.createElement(e),this.htmlElement.innerHTML=t,n!=""&&this.setClass(n)}add(e){this.htmlElement.appendChild(e.htmlElement),e.parent=this}remove(e){this.htmlElement.removeChild(e.htmlElement),e.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(e,t){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(e){this.hasClass(e)||this.htmlElement.classList.add(e)}unsetClass(e){this.hasClass(e)&&this.htmlElement.classList.remove(e)}hasClass(e){return this.htmlElement.classList.contains(e)}}class v extends d{constructor(e,t=""){super("a",e,t),this.htmlElement.onclick=n=>{n.stopPropagation(),this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class X extends d{constructor(...e){super("div");for(const t of e)this.add(t)}submit(){let e=new FormData;for(const t in this.htmlElement.children){let n=this.htmlElement.children[t];n instanceof HTMLInputElement&&e.append(n.name,n.value)}this.onSubmit(e)}onSubmit(e){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(e)}}class f extends d{constructor(e,t,n,a=""){super("input"),this.htmlElement.name=e,this.htmlElement.placeholder=t,this.htmlElement.type=n,a!=""&&this.setClass(a),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(e=void 0){return e!==void 0&&(this.htmlElement.value=e),this.htmlElement.value}onChange(e){}onChangeDone(e){}}class q extends d{constructor(e,t,n=""){super("textarea"),this.htmlElement.name=e,this.htmlElement.placeholder=t,n!=""&&this.setClass(n),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(e=void 0){return e!==void 0&&(this.htmlElement.value=e),this.htmlElement.value}onChange(e){}onChangeDone(e){}}class W extends d{constructor(t,n,a=""){super("div");i(this,"radioButton");this.radioButton=new d("input"),this.radioButton.htmlElement.name=t,this.radioButton.htmlElement.type="radio",a!=""&&this.setClass(a),this.radioButton.htmlElement.onchange=()=>{this.onChange(this.radioButton.htmlElement.checked)},this.add(this.radioButton);let s=new d("label");s.htmlElement.innerHTML=n,this.add(s)}onChange(t){console.log("RadioButton::onChange: Not implemented! Must be impleemnted by subclass.")}value(t=void 0){return t!==void 0&&(this.radioButton.htmlElement.checked=t),this.radioButton.htmlElement.checked}}class y extends d{constructor(t,n,a=""){super("div","",a);i(this,"selectedIndex",0);i(this,"radioButtons",[]);for(let s=0;s<n.length;s++){let r=new W(t,n[s],"");r.onChange=u=>{u&&(this.selectedIndex=s,this.onChange(s))},this.add(r),this.radioButtons.push(r)}}onChange(t){console.log("RadioButtonGroup::onChange: Not implemented! Must be impleemnted by subclass.")}value(t=void 0){return t!==void 0&&(this.radioButtons[t].value(!0),this.selectedIndex=t),this.selectedIndex}}class I extends d{constructor(e,t=""){super("label",e,t)}}class S extends d{constructor(t,n,a="",s=!1){super("div");i(this,"checkbox");this.checkbox=new d("input"),this.checkbox.htmlElement.name=t,this.checkbox.htmlElement.type="checkbox",this.checkbox.htmlElement.checked=s,a!=""&&this.setClass(a),this.checkbox.htmlElement.onchange=()=>{this.onChange(this.checkbox.htmlElement.checked)},this.add(this.checkbox);let r=new d("label");r.htmlElement.innerHTML=n,this.add(r)}onChange(t){console.log("Checkbox::onChange: Not implemented! Must be implemented by subclass.")}value(t=void 0){return t!==void 0&&(this.checkbox.htmlElement.checked=t),this.checkbox.htmlElement.checked}}class z extends v{onClick(){this.parent.submit()}}class J extends d{constructor(){super("div");i(this,"connections");this.setClass("loginView"),this.connections=new d("div"),this.add(this.connections);let t=new X(new I(l.LOGIN_SESSION_NAME,"loginLabel"),new f("sessionName","myserver","text","loginInput"),new I(l.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new f("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new I(l.LOGIN_API_TOKEN_LABEL,"loginLabel"),new f("apiToken","a4ef9...","password","loginInput"),new z(l.LOGIN_SUBMIT,"buttonWide"));t.setClass("loginForm"),t.onSubmit=this.onCreateSession.bind(this),this.add(t)}update(t,n){if(this.connections.htmlElement.innerHTML="",localStorage.cb_sessions){let a=JSON.parse(localStorage.cb_sessions);a.length>0&&this.connections.add(new I(l.LOGIN_KNOWN_CONNECTIONS,"loginLabel"));for(const s of a){let r=new v(s,"buttonWide");r.onClick=()=>{k(s)},this.connections.add(r)}if(a.length>0){let s=new d("hr");s.setClass("loginDivider"),this.connections.add(s)}}}async onCreateSession(t){let n=t.get("sessionName"),a=t.get("apiEndpoint"),s=t.get("apiToken");if(n==""||a==""||s==""||n==null||a==null||s==null){alert(l.LOGIN_ERROR_MISSING_INPUTS);return}let r=new E(n);if(await r.login(a,s)){let u=[];localStorage.cb_sessions&&(u=JSON.parse(localStorage.cb_sessions)),u.push(n),localStorage.cb_sessions=JSON.stringify(u),E.instance=r,g.back()}else alert(l.LOGIN_ERROR_LOGIN_FAILED)}}async function k(o,e=!1){console.log("Connecting to: "+o);let t=new E(o);await t.ping()?(E.instance=t,localStorage.cb_last_session=o,e||g.back()):e||alert("Connection refused. Either the server is not available or the connection was not used for too long.")}async function j(){if(localStorage.cb_sessions){let o=JSON.parse(localStorage.cb_sessions);if(o.length>0){let e=o[0];localStorage.cb_last_session&&(e=localStorage.cb_last_session),await k(e,!0)}}}let F='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M512 80c0 18-14.3 34.6-38.4 48c-29.1 16.1-72.5 27.5-122.3 30.9c-3.7-1.8-7.4-3.5-11.3-5C300.6 137.4 248.2 128 192 128c-8.3 0-16.4 .2-24.5 .6l-1.1-.6C142.3 114.6 128 98 128 80c0-44.2 86-80 192-80S512 35.8 512 80zM160.7 161.1c10.2-.7 20.7-1.1 31.3-1.1c62.2 0 117.4 12.3 152.5 31.4C369.3 204.9 384 221.7 384 240c0 4-.7 7.9-2.1 11.7c-4.6 13.2-17 25.3-35 35.5c0 0 0 0 0 0c-.1 .1-.3 .1-.4 .2l0 0 0 0c-.3 .2-.6 .3-.9 .5c-35 19.4-90.8 32-153.6 32c-59.6 0-112.9-11.3-148.2-29.1c-1.9-.9-3.7-1.9-5.5-2.9C14.3 274.6 0 258 0 240c0-34.8 53.4-64.5 128-75.4c10.5-1.5 21.4-2.7 32.7-3.5zM416 240c0-21.9-10.6-39.9-24.1-53.4c28.3-4.4 54.2-11.4 76.2-20.5c16.3-6.8 31.5-15.2 43.9-25.5V176c0 19.3-16.5 37.1-43.8 50.9c-14.6 7.4-32.4 13.7-52.4 18.5c.1-1.8 .2-3.5 .2-5.3zm-32 96c0 18-14.3 34.6-38.4 48c-1.8 1-3.6 1.9-5.5 2.9C304.9 404.7 251.6 416 192 416c-62.8 0-118.6-12.6-153.6-32C14.3 370.6 0 354 0 336V300.6c12.5 10.3 27.6 18.7 43.9 25.5C83.4 342.6 135.8 352 192 352s108.6-9.4 148.1-25.9c7.8-3.2 15.3-6.9 22.4-10.9c6.1-3.4 11.8-7.2 17.2-11.2c1.5-1.1 2.9-2.3 4.3-3.4V304v5.7V336zm32 0V304 278.1c19-4.2 36.5-9.5 52.1-16c16.3-6.8 31.5-15.2 43.9-25.5V272c0 10.5-5 21-14.9 30.9c-16.3 16.3-45 29.7-81.3 38.4c.1-1.7 .2-3.5 .2-5.3zM192 448c56.2 0 108.6-9.4 148.1-25.9c16.3-6.8 31.5-15.2 43.9-25.5V432c0 44.2-86 80-192 80S0 476.2 0 432V396.6c12.5 10.3 27.6 18.7 43.9 25.5C83.4 438.6 135.8 448 192 448z"/></svg>',B='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M374.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-320 320c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l320-320zM128 128A64 64 0 1 0 0 128a64 64 0 1 0 128 0zM384 384a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>',b="Date;Category;Shop;Amount/€;isCash;isTax;isDraft;Cost center;Note;uuid",D="cashbalance.csv";class L{constructor(e="",t="",n="",a=0,s=!1,r=!1,u=!1,p="",C="",O=""){this.date=e,this.category=t,this.shop=n,this.amount=a,this.isCash=s,this.isTax=r,this.isDraft=u,this.costCenter=p,this.note=C,this.uuid=O}}async function Q(o,e){let t="";t=b+`
`;for(let n=0;n<o.length;n++){let a=[o[n].date,o[n].category,o[n].shop,o[n].amount.toFixed(2).replace(".",","),o[n].isCash?"1":"0",o[n].isTax?"1":"0",o[n].isDraft?"1":"0",o[n].costCenter,o[n].note,o[n].uuid].join(";");t=t+a+`
`}return E.instance==null?(alert(l.ERROR_INVALID_SESSION),!1):await E.instance.putTxt(D,t,e)?!0:(alert(l.ERROR_SAVE_FILE),!1)}async function M(){let o=[],e="";if(E.instance==null)return alert(l.ERROR_INVALID_SESSION),null;let t=await E.instance.list(".");if(t==null)return alert(l.ERROR_READ_FILE),null;if(!t[D]){if(!await E.instance.putTxt(D,b+`
`,""))return alert(l.ERROR_CREATE_FILE),null}let n=await E.instance.readTxt(D);if(n==null)return alert(l.ERROR_READ_FILE),null;let a=n.replaceAll(`\r
`,`
`).split(`
`);if(a[0]!=b)return alert(l.ERROR_UNKNOWN_DATASTRUCTURE),null;for(let r=1;r<a.length;r++){let u=a[r];if(u=="")continue;let p=u.split(";"),C=new L(p[0],p[1],p[2],Number(p[3].replace(",",".")),p[4]=="1",p[5]=="1",p[6]=="1",p[7],p[8],p[9]);o.push(C)}let s=await E.instance.md5(D);return s==null?(alert(l.ERROR_READ_MD5),null):(e=s,{transactions:o,md5:e})}function P(o,e){if(e=="")return-1;for(let t=0;t<o.length;t++)if(o[t].uuid==e)return t;return-1}class Z extends d{constructor(){super("div");i(this,"transactions",[]);i(this,"transactionsContainer");this.transactionsContainer=new d("div","","transactionsContainer"),this.add(this.transactionsContainer);let t=new v("+","transactionAddButton");t.onClick=()=>{g.open("edit",{uuid:""})},this.add(t)}async update(t,n){E.instance==null&&g.open("login",{}),this.transactionsContainer.htmlElement.innerHTML="",this.transactions=[];let a=await M();if(a!=null){this.transactions=a.transactions;for(let s=0;s<this.transactions.length;s++){let r=new $(this.transactions[s].shop,this.transactions[s].category,this.transactions[s].amount,this.transactions[s].isCash,this.transactions[s].isTax,this.transactions[s].isDraft,this.transactions[s].date,this.transactions[s].costCenter,this.transactions[s].uuid);this.transactionsContainer.add(r)}}}}class $ extends d{constructor(t,n,a,s,r,u,p,C,O){super("div","","transactionEntry");i(this,"uuid","");this.uuid=O,this.htmlElement.onclick=G=>{G.stopPropagation(),this.onClick()};let _=new d("div","","transactionRow");this.add(_);let w=new d("div","","transactionRow");this.add(w);let R=new d("div",t);u&&R.setClass("transactionDraft"),_.add(R);let h=new d("div",p,"transactionDate");u&&h.setClass("transactionDraft"),_.add(h);let T=new d("div",F,"transactionIcon");u?T.setClass("transactionDraft"):s&&T.setClass("transactionIconActive"),_.add(T);let N=new d("div",B,"transactionIcon");u?N.setClass("transactionDraft"):r&&N.setClass("transactionIconActive"),_.add(N);let x=new d("div",n);u&&x.setClass("transactionDraft"),w.add(x);let H=a.toFixed(2).toString()+" €",A=new d("div",H,"transactionAmount");u?A.setClass("transactionDraft"):a<0&&A.setClass("transactionAmountNegative"),w.add(A);let U=new d("div",C,"transactionCostCenter");w.add(U)}onClick(){g.open("edit",{uuid:this.uuid})}}function tt(o){for(var e=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=t.length,a=0;a<o;a++)e.push(t.charAt(Math.floor(Math.random()*n)));return e.join("")}class et extends d{constructor(){super("div","","editTransaction");i(this,"md5","");i(this,"transactions",[]);i(this,"uuid","");i(this,"dateInput");i(this,"categoryInput");i(this,"shopInput");i(this,"amountInput");i(this,"cashCheckbox");i(this,"taxCheckbox");i(this,"draftCheckbox");i(this,"costCenterRadioButtonGroup");i(this,"costCenterOtherInput");i(this,"noteInput");i(this,"saveButton");let t=new I(l.EDIT_CAPTION_DATE,"editCaption");this.dateInput=new f("inputDate",l.EDIT_PLACEHOLDER_DATE,"date","editInput"),this.add(t),this.add(this.dateInput);let n=new I(l.EDIT_CAPTION_CATEGORY,"editCaption");this.categoryInput=new f("inputCategory",l.EDIT_PLACEHOLDER_CATEGORY,"text","editInput"),this.categoryInput.onChange=h=>{this.categoryInput.value(h.replaceAll(";",","))},this.categoryInput.onChangeDone=h=>{h.endsWith(" ")&&this.categoryInput.value(h.slice(0,-1))},this.add(n),this.add(this.categoryInput);let a=new I(l.EDIT_CAPTION_SHOP,"editCaption");this.shopInput=new f("inputShop",l.EDIT_PLACEHOLDER_SHOP,"text","editInput"),this.shopInput.onChange=h=>{this.shopInput.value(h.replaceAll(";",","))},this.shopInput.onChangeDone=h=>{h.endsWith(" ")&&this.shopInput.value(h.slice(0,-1))},this.add(a),this.add(this.shopInput);let s=new I(l.EDIT_CAPTION_AMOUNT,"editCaption"),r=new d("div","","editAmountContainer"),u=new y("radioAmount",[l.EDIT_RADIO_IN,l.EDIT_RADIO_OUT],"editRadioGroup");this.amountInput=new f("inputAmount",l.EDIT_PLACEHOLDER_AMOUNT,"number","editAmount");let p=new I(" €");this.amountInput.onChange=h=>{Number(h)<0?u.value(1):u.value(0)},this.amountInput.onChangeDone=h=>{let T=Number(h).toFixed(2);h!=T&&this.amountInput.value(T),console.log("Wrote amount: "+this.amountInput.value())},u.onChange=h=>{let T=Number(this.amountInput.htmlElement.value);this.amountInput.value((T*-1).toFixed(2))},u.value(0),this.add(s),r.add(u),r.add(this.amountInput),r.add(p),this.add(r);let C=new d("div","","editTag");this.cashCheckbox=new S("checkboxCash",F+" "+l.EDIT_CHECKBOX_CASH,"editIcon",!1),this.taxCheckbox=new S("checkboxTax",B+" "+l.EDIT_CHECKBOX_TAX,"editIcon",!1),this.draftCheckbox=new S("checkboxDraft",l.EDIT_CHECKBOX_DRAFT,"",!1),this.add(C),C.add(this.cashCheckbox),C.add(this.taxCheckbox),C.add(this.draftCheckbox);let O=new I(l.EDIT_CAPTION_RECEIPT,"editCaption"),_=new f("inputReceipt",l.EDIT_PLACEHOLDER_RECEIPT,"text","editInput");_.onChange=h=>{_.value(h.replaceAll(";",","))},this.add(O),this.add(_);let w=new I(l.EDIT_CAPTION_COST_CENTER,"editCaption");this.costCenterRadioButtonGroup=new y("radioCostCenter",l.EDIT_LIST_COST_CENTER,"editRadioGroup"),this.costCenterOtherInput=new f("inputCostCenterOther",l.EDIT_LIST_COST_CENTER[l.EDIT_LIST_COST_CENTER.length-1],"text","editInput"),this.costCenterOtherInput.hide(),this.costCenterOtherInput.onChange=h=>{this.costCenterOtherInput.value(h.replaceAll(";",","))},this.costCenterOtherInput.onChangeDone=h=>{h.endsWith(" ")&&this.costCenterOtherInput.value(h.slice(0,-1))},this.costCenterRadioButtonGroup.onChange=h=>{h==l.EDIT_LIST_COST_CENTER.length-1?this.costCenterOtherInput.show():this.costCenterOtherInput.hide()},this.costCenterRadioButtonGroup.value(0),this.add(w),this.add(this.costCenterRadioButtonGroup),this.add(this.costCenterOtherInput);let R=new I(l.EDIT_CAPTION_NOTE,"editCaption");this.noteInput=new q("inputNote",l.EDIT_PLACEHOLDER_NOTE,"editTextArea"),this.noteInput.onChange=h=>{this.noteInput.value(h.replaceAll(";",","))},this.noteInput.onChangeDone=h=>{h.endsWith(" ")&&this.noteInput.value(h.slice(0,-1))},this.add(R),this.add(this.noteInput),this.saveButton=new v(l.EDIT_BUTTON_SAVE,"buttonWide"),this.saveButton.onClick=this.saveTransaction.bind(this),this.add(this.saveButton)}async update(t,n){E.instance==null&&g.open("login",{});let a=await M();if(a==null)return;this.transactions=a.transactions,this.md5=a.md5;let s,r=P(this.transactions,t.uuid);if(r!=-1?(s=this.transactions[r],this.uuid=t.uuid):(s=new L,this.uuid=tt(32)),s.isDraft==!1&&s.date==""){let p=new Date;s.date=p.toISOString().split("T")[0]}this.dateInput.value(s.date),this.categoryInput.value(s.category),this.shopInput.value(s.shop),s.amount!=0?this.amountInput.value(s.amount.toFixed(2)):this.amountInput.value(""),this.amountInput.onChange(this.amountInput.value()),this.cashCheckbox.value(s.isCash),this.taxCheckbox.value(s.isTax),this.draftCheckbox.value(s.isDraft);let u=l.EDIT_LIST_COST_CENTER.indexOf(s.costCenter);s.costCenter==""&&(u=0),u==-1?(this.costCenterRadioButtonGroup.value(l.EDIT_LIST_COST_CENTER.length-1),this.costCenterOtherInput.show(),this.costCenterOtherInput.value(s.costCenter)):(this.costCenterOtherInput.hide(),this.costCenterRadioButtonGroup.value(u)),this.noteInput.value(s.note)}async saveTransaction(){this.saveButton.htmlElement.disabled=!0;let t=this.getTransactionFromInput();if(t==null)return;let n=P(this.transactions,this.uuid);n!=-1?this.transactions[n]=t:this.transactions.push(t);let a=await Q(this.transactions,this.md5);this.saveButton.htmlElement.disabled=!1,a&&g.open("transactionList",{})}getTransactionFromInput(){let t=new L,n;if(this.costCenterRadioButtonGroup.value()==l.EDIT_LIST_COST_CENTER.length-1?n=this.costCenterOtherInput.value():n=l.EDIT_LIST_COST_CENTER[this.costCenterRadioButtonGroup.value()],!this.draftCheckbox.value()){if(this.dateInput.value()=="")return alert(l.ERROR_EDIT_EMPTY_INPUT+"date."),null;if(this.categoryInput.value()=="")return alert(l.ERROR_EDIT_EMPTY_INPUT+"category."),null;if(this.shopInput.value()=="")return alert(l.ERROR_EDIT_EMPTY_INPUT+"shop."),null;if(this.amountInput.value()=="")return alert(l.ERROR_EDIT_EMPTY_INPUT+"amount."),null;if(n=="")return alert(l.ERROR_EDIT_EMPTY_INPUT+"cost center."),null}return t.date=this.dateInput.value(),t.category=this.categoryInput.value(),t.shop=this.shopInput.value(),t.amount=Number(this.amountInput.value()),t.isCash=!!this.cashCheckbox.value(),t.isTax=!!this.taxCheckbox.value(),t.isDraft=!!this.draftCheckbox.value(),t.costCenter=n,t.note=this.noteInput.value(),t.uuid=this.uuid,t}}async function nt(){Y(),document.getElementsByTagName("title")[0].innerHTML=l.APPNAME,await j(),new g("transactionList",{login:new J,transactionList:new Z,edit:new et})}nt();
