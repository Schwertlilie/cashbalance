var j=Object.defineProperty;var Q=(o,n,t)=>n in o?j(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var a=(o,n,t)=>(Q(o,typeof n!="symbol"?n+"":n,t),t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class D{constructor(n,t){a(this,"currentPage","");var e;this.defaultPage=n,this.pages=t;for(const i in t)(e=document.getElementById("app"))==null||e.appendChild(t[i].htmlElement),t[i].hide();window.onhashchange=i=>{this.onOpen()},location.hash.slice(1)==""?location.hash="#"+n:this.onOpen()}onOpen(){var c,d,m;let n={},t=location.hash.slice(1);t.length==0&&(t=this.defaultPage);let e=t.split("&"),i=e[0];e=e.splice(1);for(const p of e){let E=p.split("="),T=decodeURIComponent(E[0]),g=decodeURIComponent(E[1]);n[T]=g}let s=this.currentPage!=i;s&&(console.log("Hide page: "+this.currentPage),(c=this.pages[this.currentPage])==null||c.hide(),this.currentPage=i,console.log("Show page: "+i),(d=this.pages[this.currentPage])==null||d.show()),console.log("Calling page.update with: "+JSON.stringify(n)),(m=this.pages[this.currentPage])==null||m.update(n,s)}static open(n,t){window.setTimeout(()=>{let e="";for(let i in t)e+="&"+encodeURIComponent(i)+"="+encodeURIComponent(t[i]);location.hash="#"+encodeURIComponent(n)+e},200)}static back(){history.back()}}class l{constructor(){}static APPLY_COUNTED(n,t){return t.replace("{count}",n.toString())}}a(l,"ERROR_INVALID_SESSION","No valid session opened, go back to login."),a(l,"ERROR_SAVE_FILE","Cannot save file. It was either changed on the server or you have too weak internet."),a(l,"ERROR_READ_MD5","Cannot read md5 of file. Maye there was an error saving or your internet is weak."),a(l,"ERROR_READ_FILE","Cannot read file. Probably due to weak internet connection."),a(l,"ERROR_CREATE_FILE","Cannot create file. Probably due to weak internet connection or lack of permissions."),a(l,"ERROR_UNKNOWN_DATASTRUCTURE","Cannot parse csv due to unknown header."),a(l,"ERROR_EDIT_EMPTY_INPUT","Cannot save transaction due to empty input "),a(l,"ERROR_DATE_TOO_OLD","Date is too far in the past. Data has already been exported for this month."),a(l,"WARNING_CATEGORY_GIFT",'Category = "Geschenke" and Amount > 0: is this intended or did you mean Category = "Sonstige Einnahmen"? After confirmation of this alert, you might have to reopen the entry to change it.'),a(l,"TIME_LOCALE","en"),a(l,"TIME_YESTERDAY","yesterday"),a(l,"TIME_HOURS_AGO","{count} hour(s) ago"),a(l,"TIME_MINUTES_AGO","{count} minute(s) ago"),a(l,"TIME_SECONDS_AGO","{count} second(s) ago"),a(l,"TIME_TODAY_AT","today at"),a(l,"TIME_JUST_NOW","just now"),a(l,"TIME_EMPTY","unknown"),a(l,"APPNAME","Cashbalance"),a(l,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),a(l,"LOGIN_SESSION_NAME","Session Name"),a(l,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),a(l,"LOGIN_API_TOKEN_LABEL","API Token"),a(l,"LOGIN_SUBMIT","Add Connection"),a(l,"LOGIN_ALL_CONNECTIONS","All"),a(l,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),a(l,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?"),a(l,"LOGIN_OFFLINE_MODAL_QUESTION","Cannot connect to server. Do you want to continue in offline mode? Offline mode provides read-only view of transaction list."),a(l,"LOGIN_OFFLINE_MODAL_CONFIRM","Continue offline"),a(l,"LOGIN_OFFLINE_MODAL_CANCEL","Return to login"),a(l,"TRANSACTION_LIST_SUMMARY","{count} transactions, {startDate} - {endDate}"),a(l,"EDIT_TITLE","Edit transaction"),a(l,"EDIT_CAPTION_DATE","Date"),a(l,"EDIT_CAPTION_CATEGORY","Category"),a(l,"EDIT_CAPTION_SHOP","Shop"),a(l,"EDIT_CAPTION_AMOUNT","Amount"),a(l,"EDIT_CAPTION_RECEIPT","Receipt"),a(l,"EDIT_CAPTION_COST_CENTER","Cost center"),a(l,"EDIT_CAPTION_NOTE","Note"),a(l,"EDIT_RADIO_IN","In"),a(l,"EDIT_RADIO_OUT","Out"),a(l,"EDIT_CHECKBOX_CASH","Cash"),a(l,"EDIT_CHECKBOX_TAX","Tax"),a(l,"EDIT_CHECKBOX_FIX","Fix"),a(l,"EDIT_CHECKBOX_DRAFT","Draft"),a(l,"EDIT_BUTTON_SAVE","Save"),a(l,"EDIT_PLACEHOLDER_DATE","2023-09-01"),a(l,"EDIT_PLACEHOLDER_CATEGORY","Alimentary"),a(l,"EDIT_PLACEHOLDER_SHOP","Rewe"),a(l,"EDIT_PLACEHOLDER_AMOUNT","0.00"),a(l,"EDIT_PLACEHOLDER_RECEIPT","/path/to/receipt.png"),a(l,"EDIT_PLACEHOLDER_NOTE",""),a(l,"EDIT_PLACEHOLDER_COST_CENTER","XF"),a(l,"EDIT_LIST_COST_CENTER",["XF","MF","IF","Other"]),a(l,"EDIT_LIST_CATEGORY",["Other"]);class C extends l{}a(C,"TIME_LOCALE","de"),a(C,"TRANSACTION_LIST_SUMMARY","{count} Einträge, {startDate} - {endDate}"),a(C,"TIME_EMPTY","unbekannt"),a(C,"EDIT_TITLE","Eintrag editieren"),a(C,"EDIT_CAPTION_DATE","Datum"),a(C,"EDIT_CAPTION_CATEGORY","Kategorie"),a(C,"EDIT_CAPTION_SHOP","Handelspartner"),a(C,"EDIT_CAPTION_AMOUNT","Betrag"),a(C,"EDIT_CAPTION_RECEIPT","Beleg"),a(C,"EDIT_CAPTION_COST_CENTER","Kostenstelle"),a(C,"EDIT_CAPTION_NOTE","Notiz"),a(C,"EDIT_RADIO_IN","Ein"),a(C,"EDIT_RADIO_OUT","Aus"),a(C,"EDIT_CHECKBOX_CASH","Bar"),a(C,"EDIT_CHECKBOX_TAX","Steuerrelevant"),a(C,"EDIT_CHECKBOX_FIX","Fix"),a(C,"EDIT_CHECKBOX_DRAFT","Entwurf"),a(C,"EDIT_BUTTON_SAVE","Speichern"),a(C,"EDIT_PLACEHOLDER_CATEGORY","Lebensmittel & Haushalt"),a(C,"EDIT_PLACEHOLDER_SHOP","Rewe"),a(C,"EDIT_PLACEHOLDER_RECEIPT","/path/to/receipt.png"),a(C,"EDIT_LIST_COST_CENTER",["XF","MF","IF","Andere"]),a(C,"EDIT_LIST_CATEGORY",["Sonstige Einnahmen","Lebensmittel & Haushalt","Kleidung","Hausrat","Ausgehen","Hobby","Abos","Mobilität & Reise","Urlaub","Miete (Warm)","Strom & Heizkosten","Nebenkosten","Versicherungen","Sparpläne","Kreditrate","Sonstige Finanzkosten","Medikamente & Gesundheit","Geschenke","Spenden","Ausbildung","Sonstiges"]);let r=l;function Z(){switch(localStorage.language){case"en":case"us":r=l;break;case"de":default:r=C;break}}const b=class b{constructor(n){a(this,"apiEndpoint","");a(this,"sessionToken","");this.session_name=n,this.loadSessionConfig(),b.connections.set(n,this)}getSessionName(){return this.session_name}loadSessionConfig(){if(localStorage.webfs_sessions){let n=JSON.parse(localStorage.webfs_sessions);if(this.session_name in n){let t=n[this.session_name];this.apiEndpoint=t.apiEndpoint,this.sessionToken=t.sessionToken}}}writeSessionConfig(n,t){this.apiEndpoint=n,this.sessionToken=t;let e={};localStorage.webfs_sessions&&(e=JSON.parse(localStorage.webfs_sessions)),e[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:t},localStorage.webfs_sessions=JSON.stringify(e)}removeSession(){if(localStorage.webfs_sessions){let n=JSON.parse(localStorage.webfs_sessions);n.indexOf(this.session_name)>=0&&n.remove(this.session_name)}}async request(n){n.append("token",this.sessionToken);const t={method:"POST",body:n};try{return await fetch(this.apiEndpoint,t)}catch{return console.log("Cannot reach server. It appears you are offline."),null}}async ping(){let n=new FormData;n.append("cmd","ping"),n.append("uri",".");let t=await this.request(n);return t==null?!1:t.status!=200?(console.error(t.text()),!1):await t.text()=="pong"}async login(n,t){let e=new FormData;e.append("cmd","login"),e.append("uri","."),e.append("token",t);const i={method:"POST",body:e};let s;try{s=await fetch(n,i)}catch{return alert("Cannot connect to server. Do you have a working internet connection?"),!1}if(s.status!=200)return console.error(s.text()),!1;let c=await s.text();return this.writeSessionConfig(n,c),!0}buildFileTree(n){return n}async list(n){let t=new FormData;t.append("cmd","list"),t.append("uri",n);let e=await this.request(t);return e==null?null:e.status!=200?(console.error(e.text()),null):await e.json()}async walk(n){let t=new FormData;t.append("cmd","walk"),t.append("uri",n);let e=await this.request(t);if(e==null)return null;if(e.status!=200)return console.error(e.text()),null;let i=await e.json();return this.buildFileTree(i)}async md5(n){let t=new FormData;t.append("cmd","md5"),t.append("uri",n);let e=await this.request(t);return e==null?null:e.status!=200?(console.error(e.text()),null):e.text()}async open(n){let t=new FormData;t.append("cmd","open"),t.append("uri",n);let e=await this.request(t);return e==null?!1:e.status!=200?(console.error(e.text()),!1):(await e.text(),!0)}async readTxt(n){let t=new FormData;t.append("cmd","read"),t.append("uri",n);let e=await this.request(t);return e==null?null:e.status!=200?(console.error(e.text()),null):e.text()}readURL(n,t=0){let e="";return t!=0&&(e="&subsample=1&width="+t.toFixed(0)+"&height="+t.toFixed(0)),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(n)+e}read(n,t="_self"){function e(c,d,m){let p=document.createElement("input");p.type="hidden",p.name=d,p.value=m,c.appendChild(p)}let i=document.getElementsByTagName("body")[0],s=document.createElement("form");s.action=this.apiEndpoint,s.method="post",s.target=t,e(s,"cmd","read"),e(s,"token",this.sessionToken),e(s,"uri",n),i.appendChild(s),s.submit(),i.removeChild(s)}async putTxt(n,t,e){var i=new Blob([t],{type:"text/plain;charset=utf-8"});return this.putFile(n,i,e)}async putFile(n,t,e){let i="",s=new FormData;s.append("cmd","write"),s.append("operation","write"),s.append("uri",n),s.append("file",t),s.append("md5",e+","+i);let c=await this.request(s);return c==null?!1:c.status!=200?(console.error(c.text()),!1):(await c.text(),!0)}async mkdir(n){let t=new FormData;t.append("cmd","write"),t.append("operation","mkdir"),t.append("uri",n);let e=await this.request(t);return e==null?!1:e.status!=200?(console.error(e.text()),!1):(await e.text(),!0)}async rmdir(n){let t=new FormData;t.append("cmd","write"),t.append("operation","rmdir"),t.append("uri",n);let e=await this.request(t);return e==null?!1:e.status!=200?(console.error(e.text()),!1):(await e.text(),!0)}async mv(n,t){let e=new FormData;e.append("cmd","write"),e.append("operation","mv"),e.append("uri",n),e.append("target",t);let i=await this.request(e);return i==null?!1:i.status!=200?(console.error(i.text()),!1):(await i.text(),!0)}async rm(n,t){let e=new FormData;e.append("cmd","write"),e.append("operation","rm"),e.append("uri",n),e.append("md5",t);let i=await this.request(e);return i==null?!1:i.status!=200?(console.error(i.text()),!1):(await i.text(),!0)}};a(b,"connections",new Map);let f=b;class u{constructor(n,t="",e=""){a(this,"parent",null);a(this,"htmlElement");a(this,"displayStyle","none");this.htmlElement=document.createElement(n),this.htmlElement.innerHTML=t,e!=""&&this.setClass(e)}add(n){this.htmlElement.appendChild(n.htmlElement),n.parent=this}remove(n){this.htmlElement.removeChild(n.htmlElement),n.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(n,t){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(n){this.hasClass(n)||this.htmlElement.classList.add(n)}unsetClass(n){this.hasClass(n)&&this.htmlElement.classList.remove(n)}hasClass(n){return this.htmlElement.classList.contains(n)}}class A extends u{constructor(n,t=""){super("a",n,t),this.htmlElement.onclick=e=>{e.stopPropagation(),this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class $ extends u{constructor(...n){super("div");for(const t of n)this.add(t)}submit(){let n=new FormData;for(const t in this.htmlElement.children){let e=this.htmlElement.children[t];e instanceof HTMLInputElement&&n.append(e.name,e.value)}this.onSubmit(n)}onSubmit(n){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(n)}}class v extends u{constructor(n,t,e,i=""){super("input"),this.htmlElement.name=n,this.htmlElement.placeholder=t,this.htmlElement.type=e,i!=""&&this.setClass(i),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(n=void 0){return n!==void 0&&(this.htmlElement.value=n),this.htmlElement.value}onChange(n){}onChangeDone(n){}}class tt extends u{constructor(n,t,e=""){super("textarea"),this.htmlElement.name=n,this.htmlElement.placeholder=t,e!=""&&this.setClass(e),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)},this.htmlElement.onchange=()=>{this.onChangeDone(this.htmlElement.value)}}value(n=void 0){return n!==void 0&&(this.htmlElement.value=n),this.htmlElement.value}onChange(n){}onChangeDone(n){}}class et extends u{constructor(t,e,i=""){super("div");a(this,"radioButton");this.radioButton=new u("input"),this.radioButton.htmlElement.name=t,this.radioButton.htmlElement.type="radio",i!=""&&this.setClass(i),this.radioButton.htmlElement.onchange=()=>{this.onChange(this.radioButton.htmlElement.checked)},this.add(this.radioButton);let s=new u("label");s.htmlElement.innerHTML=e,this.add(s)}onChange(t){console.log("RadioButton::onChange: Not implemented! Must be impleemnted by subclass.")}value(t=void 0){return t!==void 0&&(this.radioButton.htmlElement.checked=t),this.radioButton.htmlElement.checked}}class H extends u{constructor(t,e,i=""){super("div","",i);a(this,"selectedIndex",0);a(this,"radioButtons",[]);for(let s=0;s<e.length;s++){let c=new et(t,e[s],"");c.onChange=d=>{d&&(this.selectedIndex=s,this.onChange(s))},this.add(c),this.radioButtons.push(c)}}onChange(t){console.log("RadioButtonGroup::onChange: Not implemented! Must be impleemnted by subclass.")}value(t=void 0){return t!==void 0&&(this.radioButtons[t].value(!0),this.selectedIndex=t),this.selectedIndex}}class O extends u{constructor(n,t=""){super("label",n,t)}}class y extends u{constructor(t,e,i="",s=!1){super("div");a(this,"checkbox");this.checkbox=new u("input"),this.checkbox.htmlElement.name=t,this.checkbox.htmlElement.type="checkbox",this.checkbox.htmlElement.checked=s,i!=""&&this.setClass(i),this.checkbox.htmlElement.onchange=()=>{this.onChange(this.checkbox.htmlElement.checked)},this.add(this.checkbox);let c=new u("label");c.htmlElement.innerHTML=e,this.add(c)}onChange(t){console.log("Checkbox::onChange: Not implemented! Must be implemented by subclass.")}value(t=void 0){return t!==void 0&&(this.checkbox.htmlElement.checked=t),this.checkbox.htmlElement.checked}}class nt extends u{constructor(t,e,i="",s=""){super("div");a(this,"dropDown");this.dropDown=new u("select","",i),this.dropDown.htmlElement.name=t;for(let c=0;c<e.length;c++){let d=new u("option",e[c],s);this.dropDown.add(d)}this.dropDown.htmlElement.onchange=()=>{this.onChange(this.dropDown.htmlElement.value)},this.add(this.dropDown)}value(t=void 0){return t!==void 0&&(this.dropDown.htmlElement.value=t),this.dropDown.htmlElement.value}onChange(t){}}class st extends A{onClick(){this.parent.submit()}}let it='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>';class at extends u{constructor(t,e){var i;super("div");a(this,"container");this.setClass(t),this.container=new u("div"),this.container.setClass(e),this.container.add(this),(i=document.getElementById("global"))==null||i.appendChild(this.container.htmlElement)}dispose(){var t;this.onExit(),(t=document.getElementById("global"))==null||t.removeChild(this.container.htmlElement)}onExit(){}update(){}}class ot extends at{constructor(n,t,e,i,s){super(n,t),this.add(new u("p",e));let c=new A(i,"popupConfirmBtn");c.onClick=()=>{this.dispose(),this.onConfirm()},this.add(c);let d=new A(s,"popupCancelBtn");d.onClick=()=>{this.dispose(),this.onCancel()},this.add(d)}onConfirm(){console.log("ConfirmCancelPopup::onConfirm not implemented. Must be implemented by subclass.")}onCancel(){console.log("ConfirmCancelPopup::onCancel not implemented. Must be implemented by subclass.")}}let _="webfs";function rt(o){_=o}class lt extends u{constructor(){super("div");a(this,"connections");this.setClass("loginView"),this.connections=new u("div"),this.add(this.connections);let t=new $(new O(r.LOGIN_SESSION_NAME,"loginLabel"),new v("sessionName","myserver","text","loginInput"),new O(r.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new v("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new O(r.LOGIN_API_TOKEN_LABEL,"loginLabel"),new v("apiToken","a4ef9...","password","loginInput"),new st(r.LOGIN_SUBMIT,"loginButtonWide"));t.setClass("loginForm"),t.onSubmit=this.onCreateSession.bind(this),this.add(t)}update(t,e){if(this.connections.htmlElement.innerHTML="",localStorage[_+"_sessions"]){let i=JSON.parse(localStorage[_+"_sessions"]);if(i.length>0&&this.connections.add(new O(r.LOGIN_KNOWN_CONNECTIONS,"loginLabel")),i.length>0){let s=new A(r.LOGIN_ALL_CONNECTIONS,"loginKnownConnectionButton");s.onClick=()=>{ht(),D.back()},this.connections.add(s)}for(const s of i){let c=new A(s,"loginKnownConnectionButton");c.onClick=()=>{ct(s)},this.connections.add(c)}if(i.length>0){let s=new u("hr");s.setClass("loginDivider"),this.connections.add(s)}}}async onCreateSession(t){let e=t.get("sessionName"),i=t.get("apiEndpoint"),s=t.get("apiToken");if(e==""||i==""||s==""||e==null||i==null||s==null){alert(r.LOGIN_ERROR_MISSING_INPUTS);return}if(await new f(e).login(i,s)){let d=[];localStorage[_+"_sessions"]&&(d=JSON.parse(localStorage[_+"_sessions"])),d.push(e),localStorage[_+"_sessions"]=JSON.stringify(d),D.back()}else f.connections.delete(e),alert(r.LOGIN_ERROR_LOGIN_FAILED)}}async function ct(o){if(console.log("Connecting to: "+o),await new f(o).ping())localStorage[_+"_last_session"]=o,D.back();else{let t=new ot("popupContent","popupContainer",r.LOGIN_OFFLINE_MODAL_QUESTION,r.LOGIN_OFFLINE_MODAL_CONFIRM,r.LOGIN_OFFLINE_MODAL_CANCEL);return new Promise(e=>{t.onConfirm=()=>{localStorage[_+"_last_session"]=o,D.back(),e()},t.onCancel=()=>{f.connections.delete(o),e()}})}}function ut(){if(localStorage[_+"_sessions"]){let o=JSON.parse(localStorage[_+"_sessions"]);if(o.length>0){let n=o[0];localStorage[_+"_last_session"]&&(n=localStorage[_+"_last_session"]),new f(n)}}}function ht(){if(localStorage[_+"_sessions"]){let o=JSON.parse(localStorage[_+"_sessions"]);if(o.length>0)for(let n of o)new f(n)}}let U='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M512 80c0 18-14.3 34.6-38.4 48c-29.1 16.1-72.5 27.5-122.3 30.9c-3.7-1.8-7.4-3.5-11.3-5C300.6 137.4 248.2 128 192 128c-8.3 0-16.4 .2-24.5 .6l-1.1-.6C142.3 114.6 128 98 128 80c0-44.2 86-80 192-80S512 35.8 512 80zM160.7 161.1c10.2-.7 20.7-1.1 31.3-1.1c62.2 0 117.4 12.3 152.5 31.4C369.3 204.9 384 221.7 384 240c0 4-.7 7.9-2.1 11.7c-4.6 13.2-17 25.3-35 35.5c0 0 0 0 0 0c-.1 .1-.3 .1-.4 .2l0 0 0 0c-.3 .2-.6 .3-.9 .5c-35 19.4-90.8 32-153.6 32c-59.6 0-112.9-11.3-148.2-29.1c-1.9-.9-3.7-1.9-5.5-2.9C14.3 274.6 0 258 0 240c0-34.8 53.4-64.5 128-75.4c10.5-1.5 21.4-2.7 32.7-3.5zM416 240c0-21.9-10.6-39.9-24.1-53.4c28.3-4.4 54.2-11.4 76.2-20.5c16.3-6.8 31.5-15.2 43.9-25.5V176c0 19.3-16.5 37.1-43.8 50.9c-14.6 7.4-32.4 13.7-52.4 18.5c.1-1.8 .2-3.5 .2-5.3zm-32 96c0 18-14.3 34.6-38.4 48c-1.8 1-3.6 1.9-5.5 2.9C304.9 404.7 251.6 416 192 416c-62.8 0-118.6-12.6-153.6-32C14.3 370.6 0 354 0 336V300.6c12.5 10.3 27.6 18.7 43.9 25.5C83.4 342.6 135.8 352 192 352s108.6-9.4 148.1-25.9c7.8-3.2 15.3-6.9 22.4-10.9c6.1-3.4 11.8-7.2 17.2-11.2c1.5-1.1 2.9-2.3 4.3-3.4V304v5.7V336zm32 0V304 278.1c19-4.2 36.5-9.5 52.1-16c16.3-6.8 31.5-15.2 43.9-25.5V272c0 10.5-5 21-14.9 30.9c-16.3 16.3-45 29.7-81.3 38.4c.1-1.7 .2-3.5 .2-5.3zM192 448c56.2 0 108.6-9.4 148.1-25.9c16.3-6.8 31.5-15.2 43.9-25.5V432c0 44.2-86 80-192 80S0 476.2 0 432V396.6c12.5 10.3 27.6 18.7 43.9 25.5C83.4 438.6 135.8 448 192 448z"/></svg>',Y='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M374.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-320 320c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l320-320zM128 128A64 64 0 1 0 0 128a64 64 0 1 0 128 0zM384 384a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>',K='<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M0 224c0 17.7 14.3 32 32 32s32-14.3 32-32c0-53 43-96 96-96H320v32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9S320 19.1 320 32V64H160C71.6 64 0 135.6 0 224zm512 64c0-17.7-14.3-32-32-32s-32 14.3-32 32c0 53-43 96-96 96H192V352c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V448H352c88.4 0 160-71.6 160-160z"/></svg>',P="Date;Category;Shop;Amount/€;isCash;isTax;isFix;isDraft;Cost center;Note;uuid",L="cashbalance.csv";class F{constructor(n="",t="",e="",i=0,s=!1,c=!1,d=!1,m=!1,p="",E="",T=""){this.date=n,this.category=t,this.shop=e,this.amount=i,this.isCash=s,this.isTax=c,this.isFix=d,this.isDraft=m,this.costCenter=p,this.note=E,this.uuid=T}}async function dt(o,n){let t="";t=P+`
`;for(let i=0;i<o.length;i++){let s=[o[i].date,o[i].category,o[i].shop,o[i].amount.toFixed(2).replace(".",","),o[i].isCash?"1":"0",o[i].isTax?"1":"0",o[i].isFix?"1":"0",o[i].isDraft?"1":"0",o[i].costCenter,o[i].note,o[i].uuid].join(";");t=t+s+`
`}let e=f.connections.values().next().value;return e==null?(alert(r.ERROR_INVALID_SESSION),!1):await e.putTxt(L,t,n)?!0:(alert(r.ERROR_SAVE_FILE),!1)}async function V(){let o=[],n="";if(f.connections.size<1)return alert(r.ERROR_INVALID_SESSION),null;let t=f.connections.values().next().value,e=await t.list(".");if(e==null)return alert(r.ERROR_READ_FILE),null;if(!e[L]){if(!await t.putTxt(L,P+`
`,""))return alert(r.ERROR_CREATE_FILE),null}let i=await t.readTxt(L);if(i==null)return alert(r.ERROR_READ_FILE),null;let s=i.replaceAll(`\r
`,`
`).split(`
`);if(s[0]!=P)return alert(r.ERROR_UNKNOWN_DATASTRUCTURE),null;for(let d=1;d<s.length;d++){let m=s[d];if(m=="")continue;let p=m.split(";"),E=new F(p[0],p[1],p[2],Number(p[3].replace(",",".")),p[4]=="1",p[5]=="1",p[6]=="1",p[7]=="1",p[8],p[9],p[10]);o.push(E)}let c=await t.md5(L);return c==null?(alert(r.ERROR_READ_MD5),null):(n=c,o=X(o),{transactions:o,md5:n})}function G(o,n){if(n=="")return-1;for(let t=0;t<o.length;t++)if(o[t].uuid==n)return t;return-1}function X(o){return o=o.sort((n,t)=>t.date.localeCompare(n.date)),o=o.sort((n,t)=>Number(t.isDraft)-Number(n.isDraft)),o}function M(o){return o.getDate().toString()+"."+(o.getMonth()+1).toString()+"."+o.getFullYear().toString()}let z="";class pt extends u{constructor(){super("div");a(this,"transactions",[]);a(this,"transactionsContainer");let t=new u("div",r.APPNAME,"transactionsTitleBar");this.add(t),this.transactionsContainer=new u("div","","transactionsContainer"),this.add(this.transactionsContainer);let e=new A("+","transactionAddButton");e.onClick=()=>{D.open("edit",{uuid:""})},this.add(e)}async update(t,e){if(f.connections.size<1)return D.open("login",{}),null;this.transactionsContainer.htmlElement.innerHTML="",this.transactions=[];let i=await V();if(i!=null){if(this.transactions=i.transactions,this.transactions.length>1){let c=this.transactions.filter(I=>!I.isDraft).map(I=>new Date(I.date)),d=c.reduce((I,w)=>I<w?I:w),m=M(d),p=c.reduce((I,w)=>I>w?I:w),E=M(p),T=r.TRANSACTION_LIST_SUMMARY;T=T.replace("{count}",this.transactions.length.toString()),T=T.replace("{startDate}",m),T=T.replace("{endDate}",E);let g=new u("div",T,"transactionSummary");this.transactionsContainer.add(g)}for(let s=0;s<this.transactions.length;s++){let c=new mt(this.transactions[s].shop,this.transactions[s].category,this.transactions[s].amount,this.transactions[s].isCash,this.transactions[s].isTax,this.transactions[s].isFix,this.transactions[s].isDraft,this.transactions[s].date,this.transactions[s].costCenter,this.transactions[s].uuid);this.transactions[s].uuid==z&&c.highlightEntry(),this.transactionsContainer.add(c)}}}}class mt extends u{constructor(t,e,i,s,c,d,m,p,E,T){super("div","","transactionEntry");a(this,"uuid","");this.uuid=T,this.htmlElement.onclick=J=>{J.stopPropagation(),this.onClick()};let g=new u("div","","transactionRow");this.add(g);let I=new u("div","","transactionRow");this.add(I);let w=new u("div",t);m&&w.setClass("transactionDraft"),g.add(w);let S="";p!=""?S=M(new Date(p)):S=r.TIME_EMPTY;let x=new u("div",S,"transactionDate");m&&x.setClass("transactionDraft"),g.add(x);let N=new u("div",U,"transactionIcon");m?N.setClass("transactionDraft"):s&&N.setClass("transactionIconActive"),g.add(N);let h=new u("div",Y,"transactionIcon");m?h.setClass("transactionDraft"):c&&h.setClass("transactionIconActive"),g.add(h);let R=new u("div",K,"transactionIcon");m?R.setClass("transactionDraft"):d&&R.setClass("transactionIconActive"),g.add(R);let B=new u("div",e);m&&B.setClass("transactionDraft"),I.add(B);let q=i.toFixed(2).toString()+" €",k=new u("div",q,"transactionAmount");m?k.setClass("transactionDraft"):i<0&&k.setClass("transactionAmountNegative"),I.add(k);let W=new u("div",E,"transactionCostCenter");I.add(W)}highlightEntry(){this.setClass("transactionEntry-highlight")}onClick(){z=this.uuid,D.open("edit",{uuid:this.uuid})}}function Ct(o){for(var n=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t.length,i=0;i<o;i++)n.push(t.charAt(Math.floor(Math.random()*e)));return n.join("")}class It extends u{constructor(){super("div","");a(this,"md5","");a(this,"transactions",[]);a(this,"uuid","");a(this,"dateInput");a(this,"categoryDropdown");a(this,"categoryInput");a(this,"shopInput");a(this,"amountInput");a(this,"cashCheckbox");a(this,"taxCheckbox");a(this,"fixCheckbox");a(this,"draftCheckbox");a(this,"costCenterRadioButtonGroup");a(this,"costCenterOtherInput");a(this,"noteInput");a(this,"saveButton");let t=new u("div","","editTitleBar"),e=new A(it,"backButton");e.onClick=()=>{history.back()};let i=new u("div",r.EDIT_TITLE,"editTitleBarText");t.add(e),t.add(i),this.add(t);let s=new u("div","","editTransaction"),c=new O(r.EDIT_CAPTION_DATE,"editCaption");this.dateInput=new v("inputDate",r.EDIT_PLACEHOLDER_DATE,"date","editInput"),s.add(c),s.add(this.dateInput);let d=new O(r.EDIT_CAPTION_CATEGORY,"editCaption");this.categoryDropdown=new nt("dropdownCategory",r.EDIT_LIST_CATEGORY,"editDropdown",""),this.categoryInput=new v("inputCategory",r.EDIT_LIST_CATEGORY[r.EDIT_LIST_CATEGORY.length-1],"text","editInput"),this.categoryInput.hide(),this.categoryInput.onChange=h=>{this.categoryInput.value(h.replaceAll(";",","))},this.categoryInput.onChangeDone=h=>{h.endsWith(" ")&&this.categoryInput.value(h.slice(0,-1))},this.categoryDropdown.onChange=h=>{h==r.EDIT_LIST_CATEGORY[r.EDIT_LIST_CATEGORY.length-1]?this.categoryInput.show():this.categoryInput.hide()},this.categoryDropdown.value(r.EDIT_LIST_CATEGORY[0]),s.add(d),s.add(this.categoryDropdown),s.add(this.categoryInput);let m=new O(r.EDIT_CAPTION_SHOP,"editCaption");this.shopInput=new v("inputShop",r.EDIT_PLACEHOLDER_SHOP,"text","editInput"),this.shopInput.onChange=h=>{this.shopInput.value(h.replaceAll(";",","))},this.shopInput.onChangeDone=h=>{h.endsWith(" ")&&this.shopInput.value(h.slice(0,-1))},s.add(m),s.add(this.shopInput);let p=new O(r.EDIT_CAPTION_AMOUNT,"editCaption"),E=new u("div","","editAmountContainer"),T=new H("radioAmount",[r.EDIT_RADIO_IN,r.EDIT_RADIO_OUT],"editRadioGroup");this.amountInput=new v("inputAmount",r.EDIT_PLACEHOLDER_AMOUNT,"number","editAmount");let g=new O(" €");this.amountInput.onChange=h=>{Number(h)<0?T.value(1):T.value(0)},this.amountInput.onChangeDone=h=>{let R=Number(h).toFixed(2);h!=R&&this.amountInput.value(R),console.log("Wrote amount: "+this.amountInput.value())},T.onChange=h=>{let R=Number(this.amountInput.htmlElement.value);this.amountInput.value((R*-1).toFixed(2))},T.value(0),s.add(p),E.add(T),E.add(this.amountInput),E.add(g),s.add(E);let I=new u("div","","editTag");this.cashCheckbox=new y("checkboxCash",U+" "+r.EDIT_CHECKBOX_CASH,"editIcon",!1),this.taxCheckbox=new y("checkboxTax",Y+" "+r.EDIT_CHECKBOX_TAX,"editIcon",!1),this.fixCheckbox=new y("checkboxFix",K+" "+r.EDIT_CHECKBOX_FIX,"editIcon",!1),this.draftCheckbox=new y("checkboxDraft",r.EDIT_CHECKBOX_DRAFT,"",!1),s.add(I),I.add(this.cashCheckbox),I.add(this.taxCheckbox),I.add(this.fixCheckbox),I.add(this.draftCheckbox);let w=new O(r.EDIT_CAPTION_RECEIPT,"editCaption"),S=new v("inputReceipt",r.EDIT_PLACEHOLDER_RECEIPT,"text","editInput");S.onChange=h=>{S.value(h.replaceAll(";",","))},s.add(w),s.add(S);let x=new O(r.EDIT_CAPTION_COST_CENTER,"editCaption");this.costCenterRadioButtonGroup=new H("radioCostCenter",r.EDIT_LIST_COST_CENTER,"editRadioGroup"),this.costCenterOtherInput=new v("inputCostCenterOther",r.EDIT_LIST_COST_CENTER[r.EDIT_LIST_COST_CENTER.length-1],"text","editInput"),this.costCenterOtherInput.hide(),this.costCenterOtherInput.onChange=h=>{this.costCenterOtherInput.value(h.replaceAll(";",","))},this.costCenterOtherInput.onChangeDone=h=>{h.endsWith(" ")&&this.costCenterOtherInput.value(h.slice(0,-1))},this.costCenterRadioButtonGroup.onChange=h=>{h==r.EDIT_LIST_COST_CENTER.length-1?this.costCenterOtherInput.show():this.costCenterOtherInput.hide()},this.costCenterRadioButtonGroup.value(0),s.add(x),s.add(this.costCenterRadioButtonGroup),s.add(this.costCenterOtherInput);let N=new O(r.EDIT_CAPTION_NOTE,"editCaption");this.noteInput=new tt("inputNote",r.EDIT_PLACEHOLDER_NOTE,"editTextArea"),this.noteInput.onChange=h=>{this.noteInput.value(h.replaceAll(";",","))},this.noteInput.onChangeDone=h=>{h.endsWith(" ")&&this.noteInput.value(h.slice(0,-1))},s.add(N),s.add(this.noteInput),this.saveButton=new A(r.EDIT_BUTTON_SAVE,"buttonWide"),this.saveButton.onClick=this.saveTransaction.bind(this),s.add(this.saveButton),this.add(s)}async update(t,e){if(f.connections.size<1)return D.open("login",{}),null;let i=await V();if(i==null)return;this.transactions=i.transactions,this.md5=i.md5;let s,c=G(this.transactions,t.uuid);if(c!=-1?(s=this.transactions[c],this.uuid=t.uuid):(s=new F,this.uuid=Ct(32)),s.isDraft==!1&&s.date==""){let p=new Date;s.date=p.toISOString().split("T")[0]}this.dateInput.value(s.date);let d=r.EDIT_LIST_CATEGORY.indexOf(s.category);s.category==""?d=0:d==r.EDIT_LIST_CATEGORY.length-1&&(d=-1),d==-1?(this.categoryDropdown.value(r.EDIT_LIST_CATEGORY[r.EDIT_LIST_CATEGORY.length-1]),this.categoryInput.show(),this.categoryInput.value(s.category)):(this.categoryDropdown.value(r.EDIT_LIST_CATEGORY[d]),this.categoryInput.hide()),this.categoryInput.value(s.category),this.shopInput.value(s.shop),s.amount!=0?this.amountInput.value(s.amount.toFixed(2)):this.amountInput.value(""),this.amountInput.onChange(this.amountInput.value()),this.cashCheckbox.value(s.isCash),this.taxCheckbox.value(s.isTax),this.fixCheckbox.value(s.isFix),this.draftCheckbox.value(s.isDraft);let m=r.EDIT_LIST_COST_CENTER.indexOf(s.costCenter);s.costCenter==""&&(m=0),m==-1?(this.costCenterRadioButtonGroup.value(r.EDIT_LIST_COST_CENTER.length-1),this.costCenterOtherInput.show(),this.costCenterOtherInput.value(s.costCenter)):(this.costCenterOtherInput.value(""),this.costCenterOtherInput.hide(),this.costCenterRadioButtonGroup.value(m)),this.noteInput.value(s.note)}async saveTransaction(){this.saveButton.htmlElement.disabled=!0;let t=this.getTransactionFromInput();if(t==null)return;this.appendTransaction(t);let e=await dt(this.transactions,this.md5);this.saveButton.htmlElement.disabled=!1,e&&D.open("transactionList",{})}getTransactionFromInput(){let t=new F,e;this.categoryDropdown.value()==r.EDIT_LIST_CATEGORY[r.EDIT_LIST_CATEGORY.length-1]?e=this.categoryInput.value():e=this.categoryDropdown.value();let i;return this.costCenterRadioButtonGroup.value()==r.EDIT_LIST_COST_CENTER.length-1?i=this.costCenterOtherInput.value():i=r.EDIT_LIST_COST_CENTER[this.costCenterRadioButtonGroup.value()],this.checkInputs(e,i)==!1?null:(t.date=this.dateInput.value(),t.category=e,t.shop=this.shopInput.value(),t.amount=Number(this.amountInput.value()),t.isCash=!!this.cashCheckbox.value(),t.isTax=!!this.taxCheckbox.value(),t.isFix=!!this.fixCheckbox.value(),t.isDraft=!!this.draftCheckbox.value(),t.costCenter=i,t.note=this.noteInput.value(),t.uuid=this.uuid,t)}checkInputs(t,e){if(!this.draftCheckbox.value()){if(this.dateInput.value()=="")return alert(r.ERROR_EDIT_EMPTY_INPUT+"date."),!1;{let i=new Date(this.dateInput.value()),s=new Date,c=new Date(s.getTime()-3*24*60*60*1e3);if(i.getMonth()<c.getMonth())return alert(r.ERROR_DATE_TOO_OLD),!1}if(t=="")return alert(r.ERROR_EDIT_EMPTY_INPUT+"category."),!1;if(t=="Geschenke"&&Number(this.amountInput.value())>0&&alert(r.WARNING_CATEGORY_GIFT),this.shopInput.value()=="")return alert(r.ERROR_EDIT_EMPTY_INPUT+"shop."),!1;if(this.amountInput.value()=="")return alert(r.ERROR_EDIT_EMPTY_INPUT+"amount."),!1;if(e=="")return alert(r.ERROR_EDIT_EMPTY_INPUT+"cost center."),!1}return!0}appendTransaction(t){let e=G(this.transactions,this.uuid);e!=-1?this.transactions[e]=t:this.transactions.unshift(t),this.transactions=X(this.transactions)}}async function Tt(){rt("cb"),Z(),document.getElementsByTagName("title")[0].innerHTML=r.APPNAME,ut(),new D("transactionList",{login:new lt,transactionList:new pt,edit:new It})}Tt();
