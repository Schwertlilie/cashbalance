var I=Object.defineProperty;var O=(a,e,t)=>e in a?I(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>(O(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();class w{constructor(e,t){i(this,"currentPage","");var s;this.defaultPage=e,this.pages=t,location.hash.slice(1)==""&&(location.hash="#"+e),window.onhashchange=n=>{this.onOpen()};for(const n in t)(s=document.getElementById("app"))==null||s.appendChild(t[n].htmlElement),t[n].hide();this.onOpen()}onOpen(){var r,p,h;let e={},t=this.defaultPage,n=location.hash.slice(1).split("&");n.length>0&&(t=n[0],n=n.splice(1));for(const u of n){let S=u.split("="),b=decodeURIComponent(S[0]),N=decodeURIComponent(S[1]);e[b]=N}let o=this.currentPage!=t;o&&(console.log("Hide page: "+this.currentPage),(r=this.pages[this.currentPage])==null||r.hide(),this.currentPage=t,console.log("Show page: "+t),(p=this.pages[this.currentPage])==null||p.show()),console.log("Calling page.update with: "+JSON.stringify(e)),(h=this.pages[this.currentPage])==null||h.update(e,o)}static open(e,t){window.setTimeout(()=>{let s="";for(let n in t)s+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n]);location.hash="#"+encodeURIComponent(e)+s},200)}static back(){history.back()}}class l{constructor(){}static APPLY_COUNTED(e,t){return t.replace("{count}",e.toString())}}i(l,"TIME_LOCALE","en"),i(l,"TIME_YESTERDAY","yesterday"),i(l,"TIME_HOURS_AGO","{count} hour(s) ago"),i(l,"TIME_MINUTES_AGO","{count} minute(s) ago"),i(l,"TIME_SECONDS_AGO","{count} second(s) ago"),i(l,"TIME_TODAY_AT","today at"),i(l,"TIME_JUST_NOW","just now"),i(l,"APPNAME","Cashbalance"),i(l,"LOGIN_KNOWN_CONNECTIONS","Reuse Connection"),i(l,"LOGIN_SESSION_NAME","Session Name"),i(l,"LOGIN_API_ENDPOINT_LABEL","API Endpoint URL"),i(l,"LOGIN_API_TOKEN_LABEL","API Token"),i(l,"LOGIN_SUBMIT","Add Connection"),i(l,"LOGIN_ERROR_MISSING_INPUTS","You must provide all fields (session name, api endpoint and api token)."),i(l,"LOGIN_ERROR_LOGIN_FAILED","The provided login information is wrong. Is the URL and API token correct?");class y extends l{}i(y,"TIME_LOCALE","de");let c=l;function L(){switch(localStorage.language){case"de":c=y;break;case"en":case"us":default:c=l;break}}class m{constructor(e){i(this,"apiEndpoint","");i(this,"sessionToken","");this.session_name=e,this.loadSessionConfig()}loadSessionConfig(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);if(this.session_name in e){let t=e[this.session_name];this.apiEndpoint=t.apiEndpoint,this.sessionToken=t.sessionToken}}}writeSessionConfig(e,t){this.apiEndpoint=e,this.sessionToken=t;let s={};localStorage.webfs_sessions&&(s=JSON.parse(localStorage.webfs_sessions)),s[this.session_name]={apiEndpoint:this.apiEndpoint,sessionToken:t},localStorage.webfs_sessions=JSON.stringify(s)}removeSession(){if(localStorage.webfs_sessions){let e=JSON.parse(localStorage.webfs_sessions);e.indexOf(this.session_name)>=0&&e.remove(this.session_name)}}request(e){e.append("token",this.sessionToken);const t={method:"POST",body:e};return fetch(this.apiEndpoint,t)}async ping(){let e=new FormData;e.append("cmd","ping"),e.append("uri",".");let t=await this.request(e);return t.status!=200?(console.error(t.text()),!1):await t.text()=="pong"}async login(e,t){let s=new FormData;s.append("cmd","login"),s.append("uri","."),s.append("token",t);let o=await fetch(e,{method:"POST",body:s});if(o.status!=200)return console.error(o.text()),!1;let r=await o.text();return this.writeSessionConfig(e,r),!0}buildFileTree(e){return e}async list(e){let t=new FormData;t.append("cmd","list"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),null):await s.json()}async walk(e){let t=new FormData;t.append("cmd","walk"),t.append("uri",e);let s=await this.request(t);if(s.status!=200)return console.error(s.text()),null;let n=await s.json();return this.buildFileTree(n)}async md5(e){let t=new FormData;t.append("cmd","md5"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),null):s.text()}async open(e){let t=new FormData;t.append("cmd","open"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}async readTxt(e){let t=new FormData;t.append("cmd","read"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),null):s.text()}readURL(e,t=!1){let s="";return t&&(s="&subsample=1&width=256&height=256"),this.apiEndpoint+"?token="+encodeURIComponent(this.sessionToken)+"&cmd=read&uri="+encodeURIComponent(e)+s}read(e,t="_self"){function s(r,p,h){let u=document.createElement("input");u.type="hidden",u.name=p,u.value=h,r.appendChild(u)}let n=document.getElementsByTagName("body")[0],o=document.createElement("form");o.action=this.apiEndpoint,o.method="post",o.target=t,s(o,"cmd","read"),s(o,"token",this.sessionToken),s(o,"uri",e),n.appendChild(o),o.submit(),n.removeChild(o)}async putTxt(e,t,s){return this.putFile(e,t,s)}async putFile(e,t,s){let n="",o=new FormData;o.append("cmd","write"),o.append("operation","write"),o.append("uri",e),o.append("file",t),o.append("md5",s+","+n);let r=await this.request(o);return r.status!=200?(console.error(r.text()),!1):(await r.text(),!0)}async mkdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","mkdir"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}async rmdir(e){let t=new FormData;t.append("cmd","write"),t.append("operation","rmdir"),t.append("uri",e);let s=await this.request(t);return s.status!=200?(console.error(s.text()),!1):(await s.text(),!0)}async mv(e,t){let s=new FormData;s.append("cmd","write"),s.append("operation","mv"),s.append("uri",e),s.append("target",t);let n=await this.request(s);return n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}async rm(e,t){let s=new FormData;s.append("cmd","write"),s.append("operation","rm"),s.append("uri",e),s.append("md5",t);let n=await this.request(s);return n.status!=200?(console.error(n.text()),!1):(await n.text(),!0)}}i(m,"instance",null);class d{constructor(e,t="",s=""){i(this,"parent",null);i(this,"htmlElement");i(this,"displayStyle","none");this.htmlElement=document.createElement(e),this.htmlElement.innerHTML=t,s!=""&&this.setClass(s)}add(e){this.htmlElement.appendChild(e.htmlElement),e.parent=this}remove(e){this.htmlElement.removeChild(e.htmlElement),e.parent=null}isVisible(){return this.htmlElement.style.display.toLowerCase()!="none"}hide(){this.isVisible()&&(this.displayStyle=this.htmlElement.style.display,this.htmlElement.style.display="None")}show(){this.displayStyle.toLowerCase()!="none"&&(this.htmlElement.style.display=this.displayStyle)}update(e,t){}select(){this.setClass("selected")}unselect(){this.unsetClass("selected")}setClass(e){this.htmlElement.classList.contains(e)||this.htmlElement.classList.add(e)}unsetClass(e){this.htmlElement.classList.contains(e)||this.htmlElement.classList.remove(e)}}class _ extends d{constructor(e,t=""){super("a",e,t),this.htmlElement.onclick=()=>{this.onClick()}}onClick(){console.log("Buttom::onClick: Not implemented! Must be implemented by subclass.")}}class C extends d{constructor(...e){super("div");for(const t of e)this.add(t)}submit(){let e=new FormData;for(const t in this.htmlElement.children){let s=this.htmlElement.children[t];s instanceof HTMLInputElement&&e.append(s.name,s.value)}this.onSubmit(e)}onSubmit(e){console.log("Form::onSubmit: Not implemented! Must be implemented by subclass."),console.log(e)}}class g extends d{constructor(e,t,s,n=""){super("input"),this.htmlElement.name=e,this.htmlElement.placeholder=t,this.htmlElement.type=s,n!=""&&this.setClass(n),this.htmlElement.oninput=()=>{this.onChange(this.htmlElement.value)}}value(e=void 0){return e!==void 0&&(this.htmlElement.value=e),this.htmlElement.value}onChange(e){}}class f extends d{constructor(e,t=""){super("label",e,t)}}class T extends _{onClick(){this.parent.submit()}}class x extends d{constructor(){super("div");i(this,"connections");this.setClass("loginView"),this.connections=new d("div"),this.add(this.connections);let t=new C(new f(c.LOGIN_SESSION_NAME,"loginLabel"),new g("sessionName","myserver","text","loginInput"),new f(c.LOGIN_API_ENDPOINT_LABEL,"loginLabel"),new g("apiEndpoint","https://myserver/webfs/api.php","url","loginInput"),new f(c.LOGIN_API_TOKEN_LABEL,"loginLabel"),new g("apiToken","a4ef9...","password","loginInput"),new T(c.LOGIN_SUBMIT,"buttonWide"));t.setClass("loginForm"),t.onSubmit=this.onCreateSession.bind(this),this.add(t)}update(t,s){if(this.connections.htmlElement.innerHTML="",localStorage.cb_sessions){let n=JSON.parse(localStorage.cb_sessions);n.length>0&&this.connections.add(new f(c.LOGIN_KNOWN_CONNECTIONS,"loginLabel"));for(const o of n){let r=new _(o,"buttonWide");r.onClick=()=>{E(o)},this.connections.add(r)}if(n.length>0){let o=new d("hr");o.setClass("loginDivider"),this.connections.add(o)}}}async onCreateSession(t){let s=t.get("sessionName"),n=t.get("apiEndpoint"),o=t.get("apiToken");if(s==""||n==""||o==""||s==null||n==null||o==null){alert(c.LOGIN_ERROR_MISSING_INPUTS);return}let r=new m(s);if(await r.login(n,o)){let p=[];localStorage.cb_sessions&&(p=JSON.parse(localStorage.cb_sessions)),p.push(s),localStorage.cb_sessions=JSON.stringify(p),m.instance=r,w.back()}else alert(c.LOGIN_ERROR_LOGIN_FAILED)}}async function E(a,e=!1){console.log("Connecting to: "+a);let t=new m(a);await t.ping()?(m.instance=t,localStorage.cb_last_session=a,e||w.back()):e||alert("Connection refused. Either the server is not available or the connection was not used for too long.")}async function k(){if(localStorage.cb_sessions){let a=JSON.parse(localStorage.cb_sessions);if(a.length>0){let e=a[0];localStorage.cb_last_session&&(e=localStorage.cb_last_session),await E(e,!0)}}}class v extends d{constructor(){super("div");i(this,"summary");this.summary=new d("div",""),this.add(this.summary);let t=new _("+","buttonWide");t.onClick=()=>{w.open("login",{})},this.add(t);let s=new g("category","hint","text");s.onChange=this.selectCategory.bind(this),this.add(s)}selectCategory(t){this.summary.htmlElement.innerText=t}}async function P(){L(),document.getElementsByTagName("title")[0].innerHTML=c.APPNAME,await k(),new w("overview",{login:new x,overview:new v})}P();
